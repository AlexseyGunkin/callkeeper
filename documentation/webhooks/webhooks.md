# Webhooks | Вебхуки

## Навигация
  - [Что нужно для отправки вебхуков](#что-нужно-для-отправки-вебхуков)
  - [Что можно делать при помощи вебхуков](#что-можно-делать-при-помощи-вебхуков)
  - [Параметры, передаваемые в вебхуках](#параметры-передаваемые-в-вебхуках)
  - [Проверка webhook](#проверка-webhook)

Вебхуки - это способ передать в стороннюю систему информацию об определенном событии.

В случае с сервисом CallKeeper|Calltracking вы можете настроить отправку данных по звонку.

## Что нужно для работы вебхуков: 

- работающий виджет 
- положительный баланс минут на аккаунте
- страница, обрабатывающая данные на стороне клиента
- для Calltracking - настроенная рекламная кампания

## Что можно делать при помощи вебхуков:

- отправлять данные по звонкам

## CallKeeper

В CallKeeper отправка вебхуков настраивается в разделе Профиль/Webhookcall

![Рис.](images/webhook_ck_main.png)

Здесь вы можете добавить адреса для отправки вебхуков по звонкам. Введите нужный URL в строку Адрес для отправки данных и нажмите "Добавить". Все добавленные адреса будут отображаться на этой странице.

Обратите внимание на столбец Отправлено. Здесь будет отображаться количество отправленных вебхуков. Вы можете проверить правильность адреса отправки, заказав тестовый звонок и посмотрев, изменилось ли число в счетчике отправленных вебхуков.

![Рис.](images/webhook_ck_inside.png)

По умолчанию по каждому звонку будет отправляться два вебхука - во время начала звонка и по завершении звонка в формате JSON. [Список параметров](#параметры-передаваемые-в-вебхуках) приведен ниже. Если вам нужно настроить вебхук по другому сценарию - обратитесь к менеджеру.


## Calltracking

В Calltracking отправка вебхуков настраивается в разделе Интеграции/Webhook Calltracking. Подробную информацию о настройке вебхуков в Calltracking смотрите в [документации](/documentation/calltracking/calltracking_instruction.md#интеграции).

Настройки Calltracking позволяют выбрать событие, по которому будет отправляться вебхук (начало или завершение звонка), изменить названия ключей для параметров запроса или выбрать content type отправляемых вебхуков. 

#### Примечание

`Вебхуки, настроенные в этом разделе, будут отправляться только по звонкам Calltracking`


## Calltracking - Webhook CallKeeper

#### Примечание

`Инструмент доступен только для аккаунтов, перенесенных с callkeeper.ru/callkeeper.com`

В личном кабинете Calltracking кроме Webhook Calltracking есть настройка вебхуков Webhook CallKeeper. Эта настройка аналогична вебхукам в личном кабинете CallKeeper - автоматическая отправка вебхуков во время начала звонка и по завершении звонка. 

Нажмите "Добавить WebHook" и введит адрес для отправки вебхуков в нужном формате.

![Рис.](images/webhook_ckct_ck.png)


#### Примечание

`Вебхуки, настроенные в этом разделе, будут отправляться только по звонкам CallKeeper`



## Параметры, передаваемые в вебхуках:

-  **id** — id звонка в системе CallKeeper
  
-  **visit_info** — массив utm меток по звонку
  
-  **current** — массив utm-меток по текущему визиту
  
-  **first** — массив utm меток по первому визиту
  
-  **session pgs** — количество просмотренных страниц (до совершения звонка)
  
-  **cpg** — страница откуда был совершен звонок
  
-  **udata vst** — порядковый номер визита
  
-  **uag** — данные User Agent
  
-  **status_code** — код статуса звонка менеджеру SIP
  
-  **status_reason** — сообщение о статусе звонка менеджеру
  
-  **status2_code** — код статуса звонка клиенту SIP
  
-  **status2_reason** — сообщение о статусе звонка клиенту
  
-  **ip** — ip адрес клиента
  
-  **country** — код страны
  
-  **city** — название города
  
-  **region** — название региона
  
-  **district** — название округа
  
-  **site** — сайт
  
-  **ga_clientid** — Google Analytics ID
  
-  **phone1** — номер тел менеджера [добавочный]
  
-  **phone2** - номер тел клиента
  
-  **widget_hash** — хеш виджета callkeeper date— дата звонка по UTC
  
-  **duration_sec** — длительность звонка в секундах
  
-  **a_type: 0** - тип соединения, который предпочел менеджер (;;;)
  
-  **asr_attempts: 0** - количество попыток голосового smartcall
  
-  **attempt: 1** - номер попытки звонка
  
-  **date: "2018-12-04 12:14:54"** - дата и время звонка
  
-  **date_timestamp: 1543925694** - дата и время звонка в формате timestamp
  
-  **duration_min: "0"** - длительность звонка в минутах (округленная длительность в секундах)
  
-  **event_source: "widget"** - тип инструмента, с которого был заказан звонок (28 вариантов)
  
-  **hook_event: "Call is over"** (после завершения звонка) - “ Call is processing” (перед звонком)
  
-  **order_date: "2018-12-04 12:14:54"** - дата и время заказа звонка
  
-  **playback_tick: 0** - количество проговариваний ivr в течение звонка
  
-  **record_url: ""** - ссылка на запись разговора
  
-  **roistat_visit: null** - (если включена интеграция с ройстат) - идентификатор клиента в системе ройстат
  
-  **tags: " "** - тэги (клиенты сами тэгируют звонки)
  
-  **ga_clid:** - id клиента в ga
  
-  **widget_name: "custom css"** - название виджета
  
-  **ya_clientid: null** - id клиента в яндекс-метрике (по умолчанию собирается у всех)
  
-  **uip - user ip** - ip клиента


## Проверка webhook

Вы можете воспользоваться сервисом http://www.webhook.site для проверки отправки вебхуков, их содержимого и формата. 
Скопируйте уникальный сгенерированный адрес и вставьте в строку адреса для вебхуков на callkeeper.ru - Профиль/WebhookCall

![Рис.](images/webhook_ck.png)


или вставьте в строки для добавления адреса на ckct.ru - Интеграции/Добавить Webhook

![Рис.](images/webhook_ckct.png)

После совершений тестового звонка вы можете посмотреть пришедший вебхук на странице сервиса [http://www.webhook.site]


[Вернуться к оглавлению](#webhooks--вебхуки)

[Вернуться на главную](/README.md#Documentation)

